---
title: Auth
description: Add user auth in one command
---

# Auth

Add email/password auth with Better Auth, session support, and a protected `me` endpoint.

---

## Installation

<Tabs items={["npm", "pnpm", "bun"]}>
  <Tab value="npm">

```bash
npx zuro-cli add auth
```

  </Tab>
  <Tab value="pnpm">

```bash
pnpm dlx zuro-cli add auth
```

  </Tab>
  <Tab value="bun">

```bash
bun x zuro-cli add auth
```

  </Tab>
</Tabs>

Also installs missing dependencies automatically: `core`, `database`, and `error-handler`.

---

## What Gets Added

<Files>
  <Folder name="src" defaultOpen>
    <Folder name="lib" defaultOpen>
      <File name="auth.ts" />
    </Folder>
    <Folder name="routes" defaultOpen>
      <File name="index.ts" />
      <File name="user.routes.ts" />
    </Folder>
    <Folder name="controllers" defaultOpen>
      <File name="user.controller.ts" />
    </Folder>
    <Folder name="db" defaultOpen>
      <Folder name="schema" defaultOpen>
        <File name="auth.ts" />
      </Folder>
    </Folder>
    <File name="app.ts" />
    <File name="env.ts" />
  </Folder>
  <File name=".env" />
</Files>

---

## Usage

<Steps>
<Step>
### Add auth

```bash
npx zuro-cli add auth
```

</Step>

<Step>
### Run migrations

```bash
npx drizzle-kit generate
npx drizzle-kit migrate
```

</Step>

<Step>
### Start server

```bash
npm run dev
```

</Step>
</Steps>

---

## App Wiring

CLI auto-injects user routes into `src/routes/index.ts`:

```ts
rootRouter.use("/users", userRoutes);
```

Better Auth is mounted directly in `app.ts` (before `express.json()`):

```ts
app.all(/^\/api\/auth(?:\/.*)?$/, toNodeHandler(auth));
app.use("/api", rootRouter);
```

---

## Environment Variables

Auth adds:

- `BETTER_AUTH_SECRET` — auto-generated if missing, kept if existing
- `BETTER_AUTH_URL` — defaults to `http://localhost:3000`

---

## Endpoints

| Path                      | Method | Purpose         |
| ------------------------- | ------ | --------------- |
| `/api/auth/sign-up/email` | `POST` | Register        |
| `/api/auth/sign-in/email` | `POST` | Login           |
| `/api/auth/sign-out`      | `POST` | Logout          |
| `/api/auth/get-session`   | `GET`  | Current session |
| `/api/users/me`           | `GET`  | Current user    |

---

## API Reference (OpenAPI)

Auth includes the Better Auth `openAPI` plugin. Inspect available endpoints at:

```text
http://localhost:3000/api/auth/reference
```

---

## Database Dialect Support

Auth schema follows your database module:

- PostgreSQL project → PostgreSQL auth schema
- MySQL project → MySQL auth schema

---

## Controller Pattern

Generated `UserController` checks session through Better Auth:

```ts
import { auth } from "../lib/auth";
import { fromNodeHeaders } from "better-auth/node";
import { UnauthorizedError } from "../lib/errors";

export const UserController = {
  async getProfile(req, res) {
    const session = await auth.api.getSession({
      headers: fromNodeHeaders(req.headers),
    });

    if (!session) {
      throw new UnauthorizedError("Not authenticated");
    }

    return res.json({ user: session.user });
  },
};
```

---

## Basic Usage Example

```bash
curl -X POST http://localhost:3000/api/auth/sign-up/email \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Briyan",
    "email": "briyan@example.com",
    "password": "password123"
  }'
```

```bash
curl http://localhost:3000/api/users/me \
  -H "Cookie: <session_cookie_here>"
```

---

## Troubleshooting

- `Module 'auth' not found`: run the install command inside a Zuro project.
- `BETTER_AUTH_URL` issues: set it to your backend origin (e.g. `http://localhost:3000`).
- Migration errors: verify `DATABASE_URL` and database existence, then rerun migration commands.
- `401 Not authenticated` on `/api/users/me`: include the session cookie from login.

---

## Next Steps

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
  <a href="/docs/database" className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline">
    <h3 className="font-bold text-foreground mb-1">→ Database</h3>
    <div className="text-sm text-muted-foreground">Review migrations, schemas, and DB setup</div>
  </a>

<a
  href="/docs/error-handler"
  className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline"
>
  <h3 className="font-bold text-foreground mb-1">→ Error Handler</h3>
  <div className="text-sm text-muted-foreground">
    Understand API error format and handling
  </div>
</a>

  <a href="/docs/mailer" className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline">
    <h3 className="font-bold text-foreground mb-1">→ Add Mailer</h3>
    <div className="text-sm text-muted-foreground">Send emails with SMTP or Resend</div>
  </a>
</div>
