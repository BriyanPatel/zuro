---
title: Auth
description: Add user auth in one command
---

# Auth

Add email/password auth with Better Auth, session support, and a protected `me` endpoint.

---

## Installation

<Tabs items={['npm', 'pnpm', 'bun']}>
  <Tab value="npm">
  ```bash
  npx zuro-cli add auth
  ```
  </Tab>
  <Tab value="pnpm">
  ```bash
  pnpm dlx zuro-cli add auth
  ```
  </Tab>
  <Tab value="bun">
  ```bash
  bun x zuro-cli add auth
  ```
  </Tab>
</Tabs>

---

## Smart Dependencies

Running `add auth` also installs missing required modules:
- `core`
- `database` (you pick PostgreSQL or MySQL if needed)
- `error-handler`

---

## What Gets Added

<Files>
  <Folder name="src" defaultOpen>
    <Folder name="lib" defaultOpen>
      <File name="auth.ts" />
    </Folder>
    <Folder name="routes" defaultOpen>
      <File name="auth.routes.ts" />
      <File name="user.routes.ts" />
    </Folder>
    <Folder name="controllers" defaultOpen>
      <File name="user.controller.ts" />
    </Folder>
    <Folder name="db" defaultOpen>
      <Folder name="schema" defaultOpen>
        <File name="auth.ts" />
      </Folder>
    </Folder>
    <File name="app.ts" />
    <File name="env.ts" />
  </Folder>
  <File name=".env" />
</Files>

---

## App Wiring

CLI auto-injects routes into `app.ts`:

```ts
app.use(authRoutes);
app.use("/api/users", userRoutes);
```

---

## Environment Variables

Auth adds:
- `BETTER_AUTH_SECRET`
- `BETTER_AUTH_URL`

Behavior:
- if `BETTER_AUTH_SECRET` is missing, Zuro generates a secure random secret
- if it already exists, Zuro keeps your existing value
- `BETTER_AUTH_URL` defaults to `http://localhost:3000` (update for your real API origin)

---

## Database Dialect Support

Auth schema generation follows your database module:
- PostgreSQL project -> PostgreSQL auth schema
- MySQL project -> MySQL auth schema

So you can use `add auth` safely on either dialect.

---

## Endpoints You Get

| Path | Method | Purpose |
|------|--------|---------|
| `/auth/sign-up/email` | `POST` | Register |
| `/auth/sign-in/email` | `POST` | Login |
| `/auth/sign-out` | `POST` | Logout |
| `/auth/session` | `GET` | Current session |
| `/api/users/me` | `GET` | Current user profile |

---

## First-Time Setup

1. Add auth:
   ```bash
   npx zuro-cli add auth
   ```
2. Run migrations:
   ```bash
   npx drizzle-kit generate
   npx drizzle-kit migrate
   ```
3. Start server:
   ```bash
   npm run dev
   ```

---

## Basic Usage Example

```bash
curl -X POST http://localhost:3000/auth/sign-up/email \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Briyan",
    "email": "briyan@example.com",
    "password": "password123"
  }'
```

```bash
curl http://localhost:3000/api/users/me \
  -H "Cookie: <session_cookie_here>"
```

---

## Controller Pattern

Generated `UserController` checks session through Better Auth:

```ts
import { auth } from "../lib/auth";
import { fromNodeHeaders } from "better-auth/node";
import { UnauthorizedError } from "../lib/errors";

export const UserController = {
  async getProfile(req, res) {
    const session = await auth.api.getSession({
      headers: fromNodeHeaders(req.headers),
    });

    if (!session) {
      throw new UnauthorizedError("Not authenticated");
    }

    return res.json({ user: session.user });
  },
};
```

---

## Troubleshooting

- `Module 'auth' not found`: run `npx zuro-cli add auth` inside a Zuro project.
- `BETTER_AUTH_URL` issues: set it to your backend origin (for example `http://localhost:3000`).
- migration errors: verify `DATABASE_URL` and database existence, then rerun migration commands.
- `401 Not authenticated` on `/api/users/me`: include session cookie from login.

---

## Next Steps

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
  <a href="/docs/database" className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline">
    <h3 className="font-bold text-foreground mb-1">→ Database</h3>
    <p className="text-sm text-muted-foreground">Review migrations, schemas, and DB setup</p>
  </a>

  <a href="/docs/error-handler" className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline">
    <h3 className="font-bold text-foreground mb-1">→ Error Handler</h3>
    <p className="text-sm text-muted-foreground">Understand API error format and handling</p>
  </a>
</div>
