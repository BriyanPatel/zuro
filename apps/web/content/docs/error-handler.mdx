---
title: Error Handler
description: Centralized API errors with safe logging
---

# Error Handler

Add a production-safe error layer for your API.

You get:
- consistent JSON error responses
- custom error classes
- async handler wrapper
- 404 handler
- safe error logging (sensitive fields redacted)

---

## Installation

<Tabs items={['npm', 'pnpm', 'bun']}>
  <Tab value="npm">
  ```bash
  npx zuro-cli add error-handler
  ```
  </Tab>
  <Tab value="pnpm">
  ```bash
  pnpm dlx zuro-cli add error-handler
  ```
  </Tab>
  <Tab value="bun">
  ```bash
  bun x zuro-cli add error-handler
  ```
  </Tab>
</Tabs>

---

## What Gets Added

<Files>
  <Folder name="src" defaultOpen>
    <Folder name="lib" defaultOpen>
      <File name="errors.ts" />
    </Folder>
    <Folder name="middleware" defaultOpen>
      <File name="error-handler.ts" />
    </Folder>
    <File name="app.ts" />
  </Folder>
</Files>

The CLI also wires this into `app.ts`:

```ts
app.use(notFoundHandler);
app.use(errorHandler);
```

---

## Error Response Contract

All errors use the same base shape:

```ts
{
  status: "error";
  code: string;
  message: string;
  requestId?: string;
  errors?: { path: string; message: string }[];
  stack?: string;
}
```

### Standard Error

```json
{
  "status": "error",
  "code": "NOT_FOUND",
  "message": "User not found"
}
```

### Validation Error

```json
{
  "status": "error",
  "code": "VALIDATION_ERROR",
  "message": "Validation failed",
  "errors": [
    { "path": "body.email", "message": "Invalid email" }
  ]
}
```

### Development Mode

In `NODE_ENV=development`, stack is included.

---

## Request ID Support

If request id is available (for example from `x-request-id` header), it is included in:
- error response (`requestId`)
- error logs (`requestId`)

Example response:

```json
{
  "status": "error",
  "code": "INTERNAL_ERROR",
  "message": "Something went wrong",
  "requestId": "req_12345"
}
```

---

## Safe Logging Behavior

Error logs redact sensitive fields from request body, including keys like:
- `password`
- `token`
- `authorization`
- `cookie`
- `secret`

So logs stay useful without leaking secrets.

---

## Usage

<Steps>
<Step>
### Throw Typed Errors

```ts
import { NotFoundError, ForbiddenError } from "./lib/errors";

if (!user) {
  throw new NotFoundError("User not found");
}

if (!canEdit) {
  throw new ForbiddenError("You cannot edit this resource");
}
```
</Step>

<Step>
### Wrap Route Handlers

```ts
import { Router } from "express";
import { asyncHandler } from "./middleware/error-handler";
import { UserController } from "./controllers/user.controller";

const router = Router();

router.get("/:id", asyncHandler(UserController.getUser));
router.post("/", asyncHandler(UserController.createUser));
```

`asyncHandler` supports both sync and async handlers.
</Step>
</Steps>

---

## Available Error Classes

| Class | Status | Default Code |
|-------|--------|--------------|
| `BadRequestError` | 400 | `BAD_REQUEST` |
| `UnauthorizedError` | 401 | `UNAUTHORIZED` |
| `ForbiddenError` | 403 | `FORBIDDEN` |
| `NotFoundError` | 404 | `NOT_FOUND` |
| `ConflictError` | 409 | `CONFLICT` |
| `ValidationError` | 422 | `VALIDATION_ERROR` |
| `InternalServerError` | 500 | `INTERNAL_ERROR` |

You can override the error code:

```ts
throw new NotFoundError("User not found", "USER_NOT_FOUND");
```

---

## Custom Error Example

```ts
import { AppError } from "./lib/errors";

export class RateLimitError extends AppError {
  constructor(message = "Too many requests") {
    super(message, 429, "RATE_LIMIT");
  }
}
```

---

## Integration Notes

- `validator` returns validation responses directly by default.
- If a `ZodError` reaches the error handler, it is formatted as `VALIDATION_ERROR` with status `422`.
- If headers were already sent, middleware safely delegates to Express (`next(err)`).

---

## Next Steps

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
  <a href="/docs/validator" className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline">
    <h3 className="font-bold text-foreground mb-1">→ Add Validator</h3>
    <p className="text-sm text-muted-foreground">Validate body/query/params before handlers</p>
  </a>

  <a href="/docs/auth" className="block border border-border rounded-xl p-5 bg-card hover:border-green-500/50 transition-colors no-underline">
    <h3 className="font-bold text-foreground mb-1">→ Add Auth</h3>
    <p className="text-sm text-muted-foreground">Add login, signup, and protected routes</p>
  </a>
</div>
